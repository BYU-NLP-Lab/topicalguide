{% extends "core/frame.html" %}
{% comment %}
The Topic Browser
Copyright 2010-2011 Brigham Young University

This file is part of the Topic Browser <http://nlp.cs.byu.edu/topic_browser>.

The Topic Browser is free software: you can redistribute it and/or modify it
under the terms of the GNU Affero General Public License as published by the
Free Software Foundation, either version 3 of the License, or (at your option)
any later version.

The Topic Browser is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License
for more details.

You should have received a copy of the GNU Affero General Public License along
with the Topic Browser.  If not, see <http://www.gnu.org/licenses/>.

If you have inquiries regarding any further use of the Topic Browser, please
contact the Copyright Licensing Office, Brigham Young University, 3760 HBLL,
Provo, UT 84602, (801) 422-9339 or 422-3821, e-mail copyright@byu.edu.
{% endcomment %}

{% block header %}{% endblock %}

{% block stylesheets %}
    {{block.super}}
    <link rel="stylesheet" href="/site-media/styles/datasets.css" type="text/css" />
{% endblock %}

{% block scripts %}
    {{block.super}}
    <script type="text/javascript" src="/site-media/scripts/datasets.js"></script>
{% endblock %}

{% block body %}
<img id="lab-logo-invisible" src="{{nlp_lab_logo_url|safe}}"/>
<a href="{{nlp_lab_url|safe}}"><img id="lab-logo" src="{{nlp_lab_logo_url|safe}}"/></a>
<header>
	<h1><a href="{{topical_guide_project_url|safe}}">The Topical Guide</a></h1>
	<h2>Available Datasets</h2>
	
</header>

{% if datasets %}
<div id="accordion">
    {% for dataset,analyses in plot_img_urls.items %}
    <div><a>{{dataset.readable_name}}</a></div>
    <div>
        <p class="description">{{dataset.description|linebreaks}}</p>
        
        {% if dataset.datasetmetricvalue_set.all %}
            <table class="metrics">
                <tr><th>Metric</th><th>Value</th></tr>
                {% for metricvalue in dataset.datasetmetricvalue_set.all %}
                <tr>
                    <td>{{metricvalue.metric.name}}</td>
                    <td>{{metricvalue.value}}</td>
                </tr>
                {% endfor %}
            </table>
        {% else %}
            <div class="ui-state-highlight">No metrics were found for this dataset.</div>
        {% endif %}
        
        {% if dataset.datasetmetainfovalue_set.all %}
            <table class="metrics">
                <tr><th>Field</th><th>Value</th></tr>
                {% for metainfovalue in dataset.datasetmetainfovalue_set.all %}
                <tr>
                    <td>{{metainfovalue.info_type.name}}</td>
                    <td>{{metainfovalue.value}}</td>
                </tr>
                {% endfor %}
            </table>
        {% else %}
            <div class="ui-state-highlight">No meta info found for this dataset.</div>
        {% endif %}
        
        
        {% if dataset.analysis_set.all %}
	        <div id="analysis-container">
		        Analyses
		        <ul class="analyses">
		        {% for analysis,plot_img_url in analyses.items %}
			        <a href="/datasets/{{dataset.name}}/analyses/{{analysis.name}}" class="analysis-link">
			            <li class="ui-widget{% ifequal analysis curanalysis %} current_analysis{% endifequal %}">
			            	<div class="ui-widget-content ui-corner-all	">
				                <div class="ui-widget-header ui-corner-all">{{analysis.readable_name}}</div>
				                
				                {% if analysis.analysismetricvalue_set.all %}
						            <table class="metrics">
						                <tr><th>Metric</th><th>Value</th></tr>
						                {% for metricvalue in analysis.analysismetricvalue_set.all %}
						                <tr>
						                    <td>{{metricvalue.metric.name}}</td>
						                    <td>{{metricvalue.value}}</td>
						                </tr>
						                {% endfor %}
						            </table>
						        {% else %}
						            <div class="ui-state-highlight">No metrics were found for this analysis.</div>
						        {% endif %}
						        
						        {% if analysis.analysismetainfovalue_set.all %}
						            <table class="metrics">
						                <tr><th>Field</th><th>Value</th></tr>
						                {% for metainfovalue in analysis.analysismetainfovalue_set.all %}
						                <tr>
						                    <td>{{metainfovalue.info_type.name}}</td>
						                    <td>{{metainfovalue.value}}</td>
						                </tr>
						                {% endfor %}
						            </table>
						        {% else %}
						            <div class="ui-state-highlight">No meta info found for this analysis.</div>
						        {% endif %}
				                
				                <div class="description">{{analysis.description|linebreaks}}</div>
				                <img id="plot_{{dataset.name}}__{{analysis.name}}" src="{{plot_img_url}}"/>
			                </div>
			            </li>
		            </a>
		        {% endfor %}
		        </ul>
	        </div>
        {% else %}
            <div class="ui-state-highlight">No analyses yet.</div>
        {% endif %}
    </div>
    {% endfor %}
</div>
<script charset="utf=8" type="text/javascript">
    {#update_plots();#}
    $( "#accordion" ).accordion();
    image_preview();
    $(".analysis-link").click(function(){
        $("html").hide("fade", {}, 250);
    });
</script>
{% else %}
    <div class="ui-state-highlight">No datasets yet. Try importing one using backend.py.</div>
{% endif %}
{% endblock %}{# end block body #}

