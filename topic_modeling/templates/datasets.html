{% extends "core/frame.html" %}
{% comment %}
The Topic Browser
Copyright 2010-2011 Brigham Young University

This file is part of the Topic Browser <http://nlp.cs.byu.edu/topic_browser>.

The Topic Browser is free software: you can redistribute it and/or modify it
under the terms of the GNU Affero General Public License as published by the
Free Software Foundation, either version 3 of the License, or (at your option)
any later version.

The Topic Browser is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License
for more details.

You should have received a copy of the GNU Affero General Public License along
with the Topic Browser.  If not, see <http://www.gnu.org/licenses/>.

If you have inquiries regarding any further use of the Topic Browser, please
contact the Copyright Licensing Office, Brigham Young University, 3760 HBLL,
Provo, UT 84602, (801) 422-9339 or 422-3821, e-mail copyright@byu.edu.
{% endcomment %}

{% load url from future %}

{% block stylesheets %}
    {{block.super}}
    <link rel="stylesheet" href="{{STYLES}}/datasets.css" type="text/css" />
{% endblock %}

{% block scripts %}
    {{block.super}}
    <script type="text/javascript" src="{{SCRIPTS}}/datasets.js"></script>
    <script charset="utf=8" type="text/javascript">
        $(document).ready(function() {
            $("#accordion").accordion();
            image_preview();
            $(".analysis-link").click(function(){
                $("html").hide("fade", {}, 250);
            });
        });
	</script>
{% endblock %}

{% block body %}
<img id="lab-logo-invisible" src="{{nlp_lab_logo_url|safe}}"/>
<a href="{{nlp_lab_url|safe}}"><img id="lab-logo" src="{{nlp_lab_logo_url|safe}}"/></a>
<header>
	<h1><a href="{{topical_guide_project_url|safe}}">The Topical Guide</a></h1>
	<h2>Available Datasets</h2>
</header>

{% if datasets %}
<div id="accordion">
    {% for dataset,analyses in plot_img_urls.items %}
    <div><a>{{dataset.readable_name}}<img class="star{% if dataset.id in favids.datasets %} fav{% endif %}" favurl="{% url 'tg-favs-dataset' dataset=dataset.name %}" /></a></div>
    <div>
    
        
        <p class="description">{{dataset.description|linebreaks}}</p>
        {% with dataset.datasetmetricvalue_set as metricval_mgr %}
	        {% if metricval_mgr.count > 0 %}
	            <table class="ui-widget metrics">
	                <thead>
	                    <tr class="ui-widget-header">
	                        <th>Metric</th><th>Value</th>
                        </tr>
                    </thead>
                    <tbody class="ui-widget-content">
		                {% for metricvalue in metricval_mgr.all %}
		                <tr>
		                    <td class="key">{{metricvalue.metric.name}}</td>
		                    <td class="value">{{metricvalue.value}}</td>
		                </tr>
		                {% endfor %}
	                </tbody>
	            </table>
	        {% else %}
	            <div class="ui-state-highlight">No metrics available for this dataset.</div>
	        {% endif %}
        {% endwith %}
        
        {% with dataset.datasetmetainfovalue_set as metadataval_mgr %}
	        {% if metadataval_mgr.count > 0 %}
	            <table class="ui-widget metadata">
	                <thead>
	                    <tr="ui-widget-header">
	                        <th>Key</th><th>Value</th><th>Type</th>
                        </tr>
                    </thead>
                    <tbody class="ui-widget-content">
		                {% for metadatavalue in metadataval_mgr.all %}
		                <tr>
		                    <td class="key">{{metadatavalue.info_type.name}}</td>
		                    <td class="value">{{metadatavalue.value}}</td>
		                    <td class="value">{{metadatavalue.type}}</td>
		                </tr>
		                {% endfor %}
	                </tbody>
	            </table>
	        {% else %}
	            <div class="ui-state-highlight">No metadata available for this dataset.</div>
	        {% endif %}
        {% endwith %}
        
        {% if dataset.analysis_set.count > 0 %}
	        <div id="analysis-container">
		        Analyses
		        <ul class="analyses">
		        {% for analysis,plot_img_url in analyses.items %}
			        
			            <li class="ui-widget{% ifequal analysis curanalysis %} current_analysis{% endifequal %}">
			            	<div class="ui-widget-content ui-corner-all	">
				                <div class="ui-widget-header ui-corner-all">
				                    <a href="{% url 'tg-analysis' dataset=dataset.name analysis=analysis.name %}" class="analysis-link">{{analysis.readable_name}}</a>
				                    <img class="star{% if analysis.id in favids.analyses %} fav{% endif %}" favurl="{% url 'tg-favs-analysis' dataset=dataset.name analysis=analysis.name %}" />
			                    </div>
				                <a href="{% url 'tg-analysis' dataset=dataset.name analysis=analysis.name %}" class="analysis-link">
					                {% with analysis.analysismetricvalue_set as metricval_mgr %}
						                {% if metricval_mgr.count > 0 %}
								            <table class="ui-widget metrics">
								                <thead>
								                    <tr class="ui-widget-header">
								                        <th>Metric</th><th>Value</th>
						                            </tr>
					                            </thead>
					                            <tbody class="ui-widget-content">
									                {% for metricvalue in analysis.analysismetricvalue_set.all %}
									                <tr>
									                    <td class="key">{{metricvalue.metric.name}}</td>
									                    <td class="value">{{metricvalue.value}}</td>
									                </tr>
									                {% endfor %}
								                </tbody>
								            </table>
								        {% else %}
								            <div class="ui-state-highlight">No metrics were found for this analysis.</div>
								        {% endif %}
							        {% endwith %}{# end with metricval_mgr #}
							        
							        {% with analysis.analysismetainfovalue_set as metadataval_mgr %}
								        {% if metadataval_mgr.count > 0 %}
								            <table class="ui-widget metrics">
								                <thead>
								                    <tr class="ui-widget-header">
								                        <th>Key</th><th>Value</th><th>Type</th>
								                    </tr>
								                </thead>
								                <tbody class="ui-widget-content">
								                {% for metadatavalue in metadataval_mgr.all %}
									                <tr>
									                    <td class="key">{{metadatavalue.info_type.name}}</td>
									                    <td class="value">{{metadatavalue.value}}</td>
									                    <td class="value">{{metadatavalue.type}}</td>
									                </tr>
									                {% endfor %}
								                </tbody>
								            </table>
								        {% else %}
								            <div class="ui-state-highlight">No metadata found for this analysis.</div>
								        {% endif %}
					                {% endwith %}{# end with metadataval_mgr #}
					                <div class="description">{{analysis.description|linebreaks}}</div>
					                <img id="plot_{{dataset.name}}__{{analysis.name}}" class="plot" src="{{plot_img_url}}"/>
				                </a>
			                </div>
			            </li>{# end analysis list item #}
		            </a>{# end a.analysis-link #}
		        {% endfor %}
		        </ul>{# end ul.analyses #}
	        </div>{# end div.analysis-container #}
        {% else %}
            <div class="ui-state-highlight">No analyses available for this dataset.</div>
        {% endif %}
    </div>{# end accordion item content div #}
    {% endfor %}
</div>{# end div#accordion #}
{% else %}
    <div class="ui-state-highlight">No datasets yet. Try importing one using backend.py.</div>
{% endif %}
{% endblock %}{# end block body #}
